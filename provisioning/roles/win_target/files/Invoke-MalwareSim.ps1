# Invoke-MalwareSim.ps1
Write-Host "[*] Malware simulation started on Windows."
# 1. Persistence: add Run key to HKCU
$regPath = "HKCU:\Software\Microsoft\Windows\CurrentVersion\Run"
New-ItemProperty -Path $regPath -Name "MalwareSim" -Value "C:\MalwareSim\Invoke-MalwareSim.ps1" -PropertyType String -Force
Write-Host "[*] Created Run key for persistence."
# 2. Simulate exfiltration: list documents to file
$docs = Get-ChildItem "$env:USERPROFILE\Documents" -Recurse -ErrorAction SilentlyContinue
$docs | Out-File C:\MalwareSim\stolen_docs.txt
Write-Host "[*] Collected user documents."
# 3. C2 beacon: HTTP GET to fake C2
$callbackUrl = "http://203.0.113.5:8080/beacon"
try { Invoke-WebRequest -Uri $callbackUrl -TimeoutSec 5; Write-Host "[*] Performed HTTP callback to $callbackUrl" }
catch { Write-Host "[*] C2 callback failed (simulated)." }
# 4. Suspicious process: launch hidden PowerShell sleep
Start-Process -FilePath "powershell.exe" -ArgumentList "-NoProfile -WindowStyle Hidden -Command Start-Sleep -s 10"
Write-Host "[*] Launched hidden PowerShell (simulating malicious process)."
# 5. Attempt scheduled task (privilege escalation simulation)
try {
  $action = New-ScheduledTaskAction -Execute "cmd.exe" -Argument "/c echo MalSim"
  $trigger = New-ScheduledTaskTrigger -Once -At (Get-Date).AddMinutes(5)
  $settings = New-ScheduledTaskSettingsSet -AllowStartIfOnBatteries
  Register-ScheduledTask -TaskName "MalSimTask" -Action $action -Trigger $trigger -Settings $settings -Description "Benign malware task"
  Write-Host "[*] Scheduled task created for persistence."
} catch {
  Write-Host "[!] Scheduled task creation failed (possibly not admin)."
}
Write-Host "[*] Malware simulation completed."
